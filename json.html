<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>JSON Folder Diff Tool (Pure JS)</title>
    <style>
        body { font-family: sans-serif; line-height: 1.5; padding: 20px; background: #f4f4f9; }
        .container { display: flex; gap: 20px; margin-bottom: 20px; }
        .box { border: 2px dashed #ccc; padding: 20px; flex: 1; text-align: center; background: white; }
        button { padding: 10px 20px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
        #results { background: white; padding: 15px; border-radius: 4px; border: 1px solid #ddd; white-space: pre-wrap; font-family: monospace; }
        .match { color: green; }
        .diff { color: #d9534f; font-weight: bold; }
        .missing { color: #f0ad4e; }
    </style>
</head>
<body>

<h2>ğŸ“ JSONãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆæ¯”è¼ƒ (Pure JS)</h2>
<p>2ã¤ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãã‚Œãã‚Œé¸æŠã—ã¦ãã ã•ã„ã€‚åŒã˜ç›¸å¯¾ãƒ‘ã‚¹ã«ã‚ã‚‹JSONã‚’æ¯”è¼ƒã—ã¾ã™ã€‚</p>

<div class="container">
    <div class="box">
        <h3>ãƒ•ã‚©ãƒ«ãƒ€ A</h3>
        <input type="file" id="folderA" webkitdirectory>
    </div>
    <div class="box">
        <h3>ãƒ•ã‚©ãƒ«ãƒ€ B</h3>
        <input type="file" id="folderB" webkitdirectory>
    </div>
</div>

<button onclick="compareFolders()">æ¯”è¼ƒå®Ÿè¡Œ</button>

<div id="results">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</div>

<script>
async function readFileAsJson(file) {
    const text = await file.text();
    try {
        return JSON.parse(text);
    } catch (e) {
        return { error: "Invalid JSON" };
    }
}

// ç°¡æ˜“çš„ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ¯”è¼ƒé–¢æ•°ï¼ˆå†å¸°ï¼‰
function deepEqual(obj1, obj2) {
    if (obj1 === obj2) return true;
    if (typeof obj1 !== 'object' || obj1 === null || typeof obj2 !== 'object' || obj2 === null) return false;
    
    const keys1 = Object.keys(obj1);
    const keys2 = Object.keys(obj2);
    if (keys1.length !== keys2.length) return false;

    for (let key of keys1) {
        if (!keys2.includes(key) || !deepEqual(obj1[key], obj2[key])) return false;
    }
    return true;
}

async function compareFolders() {
    const inputA = document.getElementById('folderA').files;
    const inputB = document.getElementById('folderB').files;
    const output = document.getElementById('results');
    
    if (inputA.length === 0 || inputB.length === 0) {
        alert("ä¸¡æ–¹ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’é¸æŠã—ã¦ãã ã•ã„");
        return;
    }

    output.innerHTML = "æ¯”è¼ƒä¸­...\n";

    // ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒãƒ—ã®ä½œæˆ (ç›¸å¯¾ãƒ‘ã‚¹ -> Fileã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)
    const mapA = new Map();
    const mapB = new Map();

    for (let f of inputA) if (f.name.endsWith('.json')) mapA.set(f.webkitRelativePath.split('/').slice(1).join('/'), f);
    for (let f of inputB) if (f.name.endsWith('.json')) mapB.set(f.webkitRelativePath.split('/').slice(1).join('/'), f);

    const allPaths = Array.from(new Set([...mapA.keys(), ...mapB.keys()])).sort();
    let report = "";

    for (let path of allPaths) {
        if (!mapA.has(path)) {
            report += `<span class="missing">[æ¬ è½] ãƒ•ã‚©ãƒ«ãƒ€Aã«ã‚ã‚Šã¾ã›ã‚“: ${path}</span>\n`;
            continue;
        }
        if (!mapB.has(path)) {
            report += `<span class="missing">[æ¬ è½] ãƒ•ã‚©ãƒ«ãƒ€Bã«ã‚ã‚Šã¾ã›ã‚“: ${path}</span>\n`;
            continue;
        }

        const jsonA = await readFileAsJson(mapA.get(path));
        const jsonB = await readFileAsJson(mapB.get(path));

        if (deepEqual(jsonA, jsonB)) {
            report += `<span class="match">[ä¸€è‡´] ${path}</span>\n`;
        } else {
            report += `<span class="diff">[ç›¸é•] ${path}</span>\n`;
            // ç°¡æ˜“çš„ãªå·®åˆ†è¡¨ç¤ºï¼ˆä¸­èº«ãŒé•ã†ã“ã¨ã ã‘é€šçŸ¥ï¼‰
            report += `       -> å†…å®¹ãŒç•°ãªã‚Šã¾ã™ã€‚è©³ç´°ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«(F12)ã§ç¢ºèªã§ãã¾ã™ã€‚\n`;
            console.log(`Diff in ${path}:`, { folderA: jsonA, folderB: jsonB });
        }
    }

    output.innerHTML = report || "JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
}
</script>
</body>
</html>
